{% extends "base.html" %}
{% block title %}Jobs · autojob-bot{% endblock %}
{% block content %}
  <section class="bg-white shadow-sm rounded-xl border border-slate-200 p-6 mb-6">
    <form method="get" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
      <label class="flex flex-col text-sm font-medium text-slate-700">
        Search
        <input type="text" name="q" value="{{ filters.q }}" placeholder="Team, role, keyword" class="mt-1 rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500" />
      </label>
      <label class="flex flex-col text-sm font-medium text-slate-700">
        Location contains
        <input type="text" name="location" value="{{ filters.location }}" class="mt-1 rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500" />
      </label>
      <label class="flex flex-col text-sm font-medium text-slate-700">
        Minimum score
        <input type="number" step="0.01" min="0" max="1" name="min_score" value="{{ filters.min_score or '' }}" class="mt-1 rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500" />
      </label>
      <label class="flex items-center gap-2 text-sm font-medium text-slate-700">
        <input type="checkbox" name="remote" value="true" {% if filters.remote %}checked{% endif %} class="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" />
        Remote only
      </label>
      <div class="sm:col-span-2 lg:col-span-4 flex gap-3">
        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Apply filters</button>
        <a href="/" class="px-4 py-2 bg-slate-100 text-slate-700 rounded-md hover:bg-slate-200">Reset</a>
      </div>
    </form>
  </section>

  <section id="jobs-table" class="bg-white shadow-sm rounded-xl border border-slate-200">
    <div class="p-4 border-b border-slate-200 flex items-center justify-between">
      <h2 class="text-lg font-semibold">Recent jobs</h2>
      <form hx-post="/ingest/run" hx-target="#ingest-status" hx-swap="innerHTML" method="post">
        <button type="submit" class="px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700">Run ingestion</button>
      </form>
    </div>
    <div id="ingest-status" class="px-4 py-2 text-sm text-slate-600"></div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-200">
        <thead class="bg-slate-50">
          <tr class="text-left text-xs font-semibold uppercase tracking-wide text-slate-600">
            <th class="px-4 py-3">Role</th>
            <th class="px-4 py-3">Company</th>
            <th class="px-4 py-3">Source</th>
            <th class="px-4 py-3">Location</th>
            <th class="px-4 py-3">Score</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          {% if jobs %}
            {% for job in jobs %}
              <tr class="hover:bg-slate-50">
                <td class="px-4 py-3">
                  <a href="/jobs/{{ job.id }}" class="font-semibold text-indigo-700 hover:underline">{{ job.title }}</a>
                </td>
                <td class="px-4 py-3">{{ job.company }}</td>
                <td class="px-4 py-3 text-sm text-slate-600">{{ job.source }}</td>
                <td class="px-4 py-3 text-sm text-slate-600">{{ job.location or '—' }}</td>
                <td class="px-4 py-3">
                  {% if job.score is not none %}
                    <span class="inline-flex items-center rounded-full bg-indigo-100 px-3 py-1 text-xs font-semibold text-indigo-700">{{ '%.2f'|format(job.score) }}</span>
                  {% else %}
                    <span class="text-slate-400 text-xs">pending</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="5" class="px-4 py-6 text-center text-sm text-slate-500">No jobs found. Try running ingestion or relaxing your filters.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </section>
{% endblock %}
